WARN[0000] /var/opt/sso/docker-compose.yml: `version` is obsolete
[+] Running 3/3
 ✔ Network sso_default       Created                                                                                                                0.1s
 ✔ Container sso-postgres-1  Created                                                                                                                0.1s
 ✔ Container sso-keycloak-1  Created                                                                                                                0.1s
Attaching to keycloak-1, postgres-1
postgres-1  |
postgres-1  | PostgreSQL Database directory appears to contain a database; Skipping initialization
postgres-1  |
postgres-1  | 2024-06-21 10:23:48.580 UTC [1] FATAL:  database files are incompatible with server
postgres-1  | 2024-06-21 10:23:48.580 UTC [1] DETAIL:  The data directory was initialized by PostgreSQL version 16, which is not compatible with this version 14.12 (Debian 14.12-1.pgdg120+1).
postgres-1 exited with code 1
keycloak-1  | Added 'admin' to '/opt/jboss/keycloak/standalone/configuration/keycloak-add-user.json', restart server to load user
keycloak-1  | start-dev
keycloak-1  | =========================================================================
keycloak-1  |
keycloak-1  |   Using PostgreSQL database
keycloak-1  |
keycloak-1  | =========================================================================
keycloak-1  |
keycloak-1  | 10:23:51,556 INFO  [org.jboss.modules] (CLI command executor) JBoss Modules version 1.11.0.Final
keycloak-1  | 10:23:51,614 INFO  [org.jboss.msc] (CLI command executor) JBoss MSC version 1.4.12.Final
keycloak-1  | 10:23:51,619 INFO  [org.jboss.threads] (CLI command executor) JBoss Threads version 2.4.0.Final
keycloak-1  | 10:23:51,723 INFO  [org.jboss.as] (MSC service thread 1-1) WFLYSRV0049: Keycloak 15.0.2 (WildFly Core 15.0.1.Final) starting
keycloak-1  | 10:23:51,815 INFO  [org.jboss.vfs] (MSC service thread 1-3) VFS000002: Failed to clean existing content for temp file provider of type temp. Enable DEBUG level log to find what caused this
keycloak-1  | 10:23:52,389 INFO  [org.wildfly.security] (ServerService Thread Pool -- 16) ELY00001: WildFly Elytron version 1.15.3.Final
keycloak-1  | 10:23:52,790 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 4) WFLYCTL0033: Extension 'security' is deprecated and may not be supported in future versions
keycloak-1  | 10:23:53,035 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute 'security-realm' in the resource at address '/core-service=management/management-interface=http-interface' is deprecated, and may be removed in a future version. See the attribute description in the output of the read-resource-description operation to learn more about the deprecation.
keycloak-1  | 10:23:53,122 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute 'security-realm' in the resource at address '/subsystem=undertow/server=default-server/https-listener=https' is deprecated, and may be removed in a future version. See the attribute description in the output of the read-resource-description operation to learn more about the deprecation.
keycloak-1  | 10:23:53,223 WARN  [org.wildfly.extension.elytron] (MSC service thread 1-5) WFLYELY00023: KeyStore file '/opt/jboss/keycloak/standalone/configuration/application.keystore' does not exist. Used blank.
keycloak-1  | 10:23:53,235 WARN  [org.wildfly.extension.elytron] (MSC service thread 1-7) WFLYELY01084: KeyStore /opt/jboss/keycloak/standalone/configuration/application.keystore not found, it will be auto generated on first use with a self-signed certificate for host localhost
keycloak-1  | WARNING: An illegal reflective access operation has occurred
keycloak-1  | WARNING: Illegal reflective access by org.wildfly.extension.elytron.SSLDefinitions (jar:file:/opt/jboss/keycloak/modules/system/layers/base/org/wildfly/extension/elytron/main/wildfly-elytron-integration-15.0.1.Final.jar!/) to method com.sun.net.ssl.internal.ssl.Provider.isFIPS()
keycloak-1  | WARNING: Please consider reporting this to the maintainers of org.wildfly.extension.elytron.SSLDefinitions
keycloak-1  | WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
keycloak-1  | WARNING: All illegal access operations will be denied in a future release
keycloak-1  | 10:23:53,266 INFO  [org.jboss.as.patching] (MSC service thread 1-5) WFLYPAT0050: Keycloak cumulative patch ID is: base, one-off patches include: none
keycloak-1  | 10:23:53,290 WARN  [org.jboss.as.domain.management.security] (MSC service thread 1-6) WFLYDM0111: Keystore /opt/jboss/keycloak/standalone/configuration/application.keystore not found, it will be auto generated on first use with a self signed certificate for host localhost
keycloak-1  | 10:23:53,358 INFO  [org.jboss.as.server] (Controller Boot Thread) WFLYSRV0212: Resuming server
keycloak-1  | 10:23:53,368 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: Keycloak 15.0.2 (WildFly Core 15.0.1.Final) started in 1796ms - Started 59 of 82 services (32 services are lazy, passive or on-demand)
keycloak-1  | The batch executed successfully
keycloak-1  | 10:23:53,560 INFO  [org.jboss.as] (MSC service thread 1-6) WFLYSRV0050: Keycloak 15.0.2 (WildFly Core 15.0.1.Final) stopped in 30ms
keycloak-1  | 10:23:54,816 INFO  [org.jboss.modules] (CLI command executor) JBoss Modules version 1.11.0.Final
keycloak-1  | 10:23:54,877 INFO  [org.jboss.msc] (CLI command executor) JBoss MSC version 1.4.12.Final
keycloak-1  | 10:23:54,882 INFO  [org.jboss.threads] (CLI command executor) JBoss Threads version 2.4.0.Final
keycloak-1  | 10:23:54,995 INFO  [org.jboss.as] (MSC service thread 1-1) WFLYSRV0049: Keycloak 15.0.2 (WildFly Core 15.0.1.Final) starting
keycloak-1  | 10:23:55,114 INFO  [org.jboss.vfs] (MSC service thread 1-3) VFS000002: Failed to clean existing content for temp file provider of type temp. Enable DEBUG level log to find what caused this
keycloak-1  | 10:23:55,717 INFO  [org.wildfly.security] (ServerService Thread Pool -- 21) ELY00001: WildFly Elytron version 1.15.3.Final
keycloak-1  | 10:23:56,141 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 15) WFLYCTL0033: Extension 'security' is deprecated and may not be supported in future versions
keycloak-1  | 10:23:56,479 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute 'security-realm' in the resource at address '/core-service=management/management-interface=http-interface' is deprecated, and may be removed in a future version. See the attribute description in the output of the read-resource-description operation to learn more about the deprecation.
keycloak-1  | 10:23:56,576 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute 'security-realm' in the resource at address '/subsystem=undertow/server=default-server/https-listener=https' is deprecated, and may be removed in a future version. See the attribute description in the output of the read-resource-description operation to learn more about the deprecation.
keycloak-1  | 10:23:56,672 WARN  [org.wildfly.extension.elytron] (MSC service thread 1-4) WFLYELY00023: KeyStore file '/opt/jboss/keycloak/standalone/configuration/application.keystore' does not exist. Used blank.
keycloak-1  | 10:23:56,682 WARN  [org.wildfly.extension.elytron] (MSC service thread 1-7) WFLYELY01084: KeyStore /opt/jboss/keycloak/standalone/configuration/application.keystore not found, it will be auto generated on first use with a self-signed certificate for host localhost
keycloak-1  | WARNING: An illegal reflective access operation has occurred
keycloak-1  | WARNING: Illegal reflective access by org.wildfly.extension.elytron.SSLDefinitions (jar:file:/opt/jboss/keycloak/modules/system/layers/base/org/wildfly/extension/elytron/main/wildfly-elytron-integration-15.0.1.Final.jar!/) to method com.sun.net.ssl.internal.ssl.Provider.isFIPS()
keycloak-1  | WARNING: Please consider reporting this to the maintainers of org.wildfly.extension.elytron.SSLDefinitions
keycloak-1  | WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
keycloak-1  | WARNING: All illegal access operations will be denied in a future release
keycloak-1  | 10:23:56,704 INFO  [org.jboss.as.patching] (MSC service thread 1-3) WFLYPAT0050: Keycloak cumulative patch ID is: base, one-off patches include: none
keycloak-1  | 10:23:56,730 WARN  [org.jboss.as.domain.management.security] (MSC service thread 1-6) WFLYDM0111: Keystore /opt/jboss/keycloak/standalone/configuration/application.keystore not found, it will be auto generated on first use with a self signed certificate for host localhost
keycloak-1  | 10:23:56,821 INFO  [org.jboss.as.server] (Controller Boot Thread) WFLYSRV0212: Resuming server
keycloak-1  | 10:23:56,827 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: Keycloak 15.0.2 (WildFly Core 15.0.1.Final) started in 2004ms - Started 59 of 89 services (39 services are lazy, passive or on-demand)
keycloak-1  | The batch executed successfully
keycloak-1  | 10:23:56,973 INFO  [org.jboss.as] (MSC service thread 1-8) WFLYSRV0050: Keycloak 15.0.2 (WildFly Core 15.0.1.Final) stopped in 18ms
keycloak-1  | =========================================================================
keycloak-1  |
keycloak-1  |   JBoss Bootstrap Environment
keycloak-1  |
keycloak-1  |   JBOSS_HOME: /opt/jboss/keycloak
keycloak-1  |
keycloak-1  |   JAVA: java
keycloak-1  |
keycloak-1  |   JAVA_OPTS:  -server -Xms64m -Xmx512m -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true   --add-exports=java.base/sun.nio.ch=ALL-UNNAMED --add-exports=jdk.unsupported/sun.misc=ALL-UNNAMED --add-exports=jdk.unsupported/sun.reflect=ALL-UNNAMED
keycloak-1  |
keycloak-1  | =========================================================================
keycloak-1  |
keycloak-1  | 10:23:57,739 INFO  [org.jboss.modules] (main) JBoss Modules version 1.11.0.Final
keycloak-1  | WFLYSRV0073: Invalid option 'start-dev'
keycloak-1  |
keycloak-1  | Usage: standalone.sh [args...]
keycloak-1  | where args include:
keycloak-1  |     --admin-only                        Set the server's running type to
keycloak-1  |                                         ADMIN_ONLY causing it to open
keycloak-1  |                                         administrative interfaces and accept
keycloak-1  |                                         management requests but not start other
keycloak-1  |                                         runtime services or accept end user
keycloak-1  |                                         requests. Cannot be used in conjunction
keycloak-1  |                                         with --start-mode. Deprecated; use
keycloak-1  |                                         --start-mode=admin-only instead.
keycloak-1  |
keycloak-1  |
keycloak-1  |     -b <value>, -b=<value>              Set system property jboss.bind.address
keycloak-1  |                                         to the given value
keycloak-1  |
keycloak-1  |
keycloak-1  |     -b<interface>=<value>               Set system property
keycloak-1  |                                         jboss.bind.address.<interface> to the
keycloak-1  |                                         given value
keycloak-1  |
keycloak-1  |
keycloak-1  |     -c <config>, -c=<config>            Name of the server configuration file
keycloak-1  |                                         to use (default is "standalone.xml")
keycloak-1  |                                         (Same as --server-config)
keycloak-1  |
keycloak-1  |
keycloak-1  |     --debug [<port>]                    Activate debug mode with an optional
keycloak-1  |                                         argument to specify the port. Only
keycloak-1  |                                         works if the launch script supports it.
keycloak-1  |
keycloak-1  |
keycloak-1  |     -D<name>[=<value>]                  Set a system property
keycloak-1  |
keycloak-1  |
keycloak-1  |     -h, --help                          Display this message and exit
keycloak-1  |
keycloak-1  |
keycloak-1  |     --read-only-server-config=<config>  Name of the server configuration file
keycloak-1  |                                         to use. This differs from
keycloak-1  |                                         '--server-config' and '-c' in that the
keycloak-1  |                                         original file is never overwritten.
keycloak-1  |
keycloak-1  |
keycloak-1  |     -P <url>, -P=<url>,                 Load system properties from the given
keycloak-1  |          --properties=<url>             url
keycloak-1  |
keycloak-1  |
keycloak-1  |     -S<name>[=<value>]                  Set a security property
keycloak-1  |
keycloak-1  |
keycloak-1  |     --server-config=<config>            Name of the server configuration file
keycloak-1  |                                         to use (default is "standalone.xml")
keycloak-1  |                                         (Same as -c)
keycloak-1  |
keycloak-1  |
keycloak-1  |     -u <value>, -u=<value>              Set system property
keycloak-1  |                                         jboss.default.multicast.address to the
keycloak-1  |                                         given value
keycloak-1  |
keycloak-1  |
keycloak-1  |     -v, -V, --version                   Print version and exit
keycloak-1  |
keycloak-1  |
keycloak-1  |     -secmgr                             Runs the server with a security manager
keycloak-1  |                                         installed.
keycloak-1  |
keycloak-1  |
keycloak-1  |     --start-mode                        Sets the start mode of the server, it
keycloak-1  |                                         can be either 'normal','admin-only' or
keycloak-1  |                                         'suspend'. If this is 'suspend' the
keycloak-1  |                                         server will start in suspended mode,
keycloak-1  |                                         and will not service requests until it
keycloak-1  |                                         has been resumed. If this is started in
keycloak-1  |                                         admin-only mode the server will only
keycloak-1  |                                         open administrative interfaces and
keycloak-1  |                                         accept management requests but not
keycloak-1  |                                         start other runtime services or accept
keycloak-1  |                                         end user requests. Cannot be used in
keycloak-1  |                                         conjunction with --admin-only.
keycloak-1  |
keycloak-1  |
keycloak-1  |     --graceful-startup=<value>          Start the server gracefully, queuing or
keycloak-1  |                                         cleanly rejecting requests until the
keycloak-1  |                                         server is fully started
keycloak-1  |
keycloak-1  |
keycloak-1  |     --git-repo <repo_url>,              The git repository to clone to get the
keycloak-1  |          --git-repo=<repo_url>          server configuration.
keycloak-1  |
keycloak-1  |
keycloak-1  |     --git-branch <branch>,              The git branch to use to get the server
keycloak-1  |          --git-branch=<branch>          configuration. Default is 'master'
keycloak-1  |
keycloak-1  |
keycloak-1  |     --git-auth <auth_config>,           The elytron configuration file for
keycloak-1  |          --git-auth=<auth_config>       managing git credentials. Default is
keycloak-1  |                                         'null'
keycloak-1  |
keycloak-1  |
keycloak-1  | 10:23:58,111 FATAL [org.jboss.as.server] (main) WFLYSRV0239: Aborting with exit code 1
keycloak-1  |
keycloak-1 exited with code 1
root@opexwise-ui-demo:/var/opt/sso# cat docker-compose.yml
version: '3'
services:
  postgres:
      image: postgres:14
      ports:
        - 4002:5432
      volumes:
        - ./pg_data:/var/lib/postgresql/data
      environment:
        POSTGRES_DB: keycloak
        POSTGRES_USER: iopex
        POSTGRES_PASSWORD: password
  keycloak:
      image: iopexlabs/keycloak:1.1
      environment:
        KEYCLOAK_FRONTEND_URL: https://dev.opexwise.ai:8008/auth
        PROXY_ADDRESS_FORWARDING: "true"
        DB_VENDOR: POSTGRES
        DB_ADDR: postgres
        DB_DATABASE: keycloak
        DB_USER: iopex
        DB_SCHEMA: public
        DB_PASSWORD: password
        KEYCLOAK_USER: admin
        KEYCLOAK_PASSWORD: admin
        KEYCLOAK_CORS: "true"
        # Uncomment the line below if you want to specify JDBC parameters. The parameter below is just an example, and it shouldn't be used in production without knowledge. It is highly recommended that you read the PostgreSQL JDBC driver documentation in order to use it.
        JDBC_PARAMS: "ssl=true"
      ports:
        - 8008:8080
      depends_on:
        - postgres
      command: ["start-dev"]
root@opexwise-ui-demo:/var/opt/sso#
